#!/usr/bin/env bash

TOKEN=""
FILES=()

while [[ $# -gt 0 ]]; do
  case "$1" in
    -t|--token)
      TOKEN="${2:-}"
      shift 2
      ;;
    --)
      shift
      while [[ $# -gt 0 ]]; do FILES+=("$1"); shift; done
      ;;
    -*)
      echo "Unknown option: $1" >&2
      exit 2
      ;;
    *)
      FILES+=("$1")
      shift
      ;;
  esac
done

for f in "${FILES[@]}"; do
  if [[ ! -f "$f" ]]; then
    echo "no: $f" >&2
    continue
  fi

  echo "Uploading $f"

  CURL_OPTS=( -F "file=@${f}" "https://upload.gofile.io/uploadfile" )
  if [[ -n "$TOKEN" ]]; then
    CURL_OPTS+=( -H "Authorization: Bearer ${TOKEN}" )
  fi

  curl "${CURL_OPTS[@]}" | jq
done

